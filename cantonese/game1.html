<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æˆ‘é¾æ„æ‰é¬¼</title>
<style>
body {
    margin: 0;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    font-family: 'Arial', sans-serif;
}
#gameContainer {
    text-align: center;
    background: white;
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
}
#verbDisplay {
    font-size: 36px;
    font-weight: bold;
    color: #667eea;
    margin-bottom: 10px;
}
#scoreDisplay {
    font-size: 24px;
    font-weight: bold;
    color: #2d3436;
    margin-bottom: 10px;
}
canvas {
    border: 4px solid #667eea;
    background: linear-gradient(135deg, #ffeaa7 0%, #74b9ff 100%);
    display: block;
    margin: 0 auto;
    border-radius: 10px;
}
h1 { color: #667eea; font-size: 48px; margin-bottom: 20px;}
button {
    font-size: 24px; padding: 15px 40px; background: #667eea;
    color: white; border: none; border-radius: 10px; cursor: pointer;
    font-weight: bold; transition: background 0.3s; margin: 10px;
}
button:hover { background: #764ba2;}
.instructions { font-size: 18px; color: #333; max-width: 600px; margin: 20px auto; line-height: 1.6;}
.mode-buttons { display: flex; gap: 20px; justify-content: center; margin: 20px 0;}
.highscores { margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 10px; max-width: 400px; margin-left:auto;margin-right:auto;}
.highscores h3 { color:#667eea; margin-bottom:10px;}
.score-item { padding:8px; margin:5px 0; background:white; border-radius:5px; font-weight:bold;}
</style>
</head>
<body>
<div id="gameContainer">
    <div id="startScreen">
        <h1>ğŸ• æˆ‘é¾æ„æ‰é¬¼ ğŸ‘»</h1>
        <div class="instructions">
            <p>Use arrow keys to help the dog catch all the ghosts!</p>
            <p>Match the English phrase with the correct Cantonese word.</p>
        </div>
        <div class="mode-buttons">
            <button onclick="startGame()">Start Game</button>
        </div>
        <div class="highscores">
            <h3>High Score</h3>
            <div class="score-item">Score: <span id="highScoreDisplay">0</span></div>
        </div>
    </div>
    <div id="gameScreen" style="display:none;">
        <div id="verbDisplay"></div>
        <div id="scoreDisplay"></div>
        <canvas id="gameCanvas" width="600" height="600"></canvas>
    </div>
    <div id="winScreen" style="display:none;">
        <h1>ğŸ‰ æ­å–œï¼ ğŸ‰</h1>
        <p class="instructions" id="winMessage"></p>
        <button onclick="showStartScreen()">Return to Home</button>
    </div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const gridSize = 30;
const tileCount = 20;

// Cantonese phrases
const verbs = [
    { english: 'already ate', cantonese: 'é£Ÿå’—é£¯' },
    { english: 'eating now', cantonese: 'é£Ÿç·Šé£¯' },
    { english: 'went out', cantonese: 'å‡ºå’—å»' },
    { english: 'coming now', cantonese: 'åšŸç·Š' },
    { english: 'not going', cantonese: 'å””å»' },
    { english: 'not eating', cantonese: 'å””é£Ÿ' },
    { english: 'donâ€™t have money', cantonese: 'å†‡éŒ¢' },
    { english: 'donâ€™t want to go', cantonese: 'å””æƒ³å»' },
    { english: 'just arrived', cantonese: 'å•±å•±åšŸ' },
    { english: 'already left', cantonese: 'å·²ç¶“èµ°å’—' },
];

let dog = { x:10, y:10 };
let ghosts = [];
let direction = {x:0, y:0};
let score=0;
let gameLoop;

function startGame(){
    document.getElementById('startScreen').style.display='none';
    document.getElementById('gameScreen').style.display='block';
    score=0;
    document.getElementById('scoreDisplay').textContent='Score: 0';
    initLevel();
    gameLoop = setInterval(update,150);
}

function showStartScreen(){
    document.getElementById('winScreen').style.display='none';
    document.getElementById('startScreen').style.display='block';
    document.getElementById('highScoreDisplay').textContent=score;
}

function initLevel(){
    dog={x:10, y:10};
    direction={x:0, y:0};
    ghosts=[];
    // choose 3 random ghosts per level
    let usedIndexes=[];
    while(ghosts.length<3){
        let index = Math.floor(Math.random()*verbs.length);
        if(!usedIndexes.includes(index)){
            usedIndexes.push(index);
            let x=Math.floor(Math.random()*(tileCount-6))+3;
            let y=Math.floor(Math.random()*(tileCount-6))+3;
            ghosts.push({x:x, y:y, english:verbs[index].english, cantonese:verbs[index].cantonese});
        }
    }
    // choose one as target
    let targetIndex=Math.floor(Math.random()*ghosts.length);
    currentTarget = ghosts[targetIndex];
    document.getElementById('verbDisplay').textContent = currentTarget.english;
}

document.addEventListener('keydown', (e)=>{
    if(e.key==='ArrowUp'){ direction={x:0,y:-1};}
    else if(e.key==='ArrowDown'){ direction={x:0,y:1};}
    else if(e.key==='ArrowLeft'){ direction={x:-1,y:0};}
    else if(e.key==='ArrowRight'){ direction={x:1,y:0};}
});

function update(){
    dog.x+=direction.x;
    dog.y+=direction.y;
    if(dog.x<0) dog.x=tileCount-1;
    if(dog.x>=tileCount) dog.x=0;
    if(dog.y<0) dog.y=tileCount-1;
    if(dog.y>=tileCount) dog.y=0;

    // check collisions
    for(let i=ghosts.length-1;i>=0;i--){
        if(Math.abs(dog.x-ghosts[i].x)<=0.5 && Math.abs(dog.y-ghosts[i].y)<=0.5){
            if(ghosts[i]===currentTarget){
                score++;
                document.getElementById('scoreDisplay').textContent='Score: '+score;
                if(score>=5){
                    clearInterval(gameLoop);
                    document.getElementById('gameScreen').style.display='none';
                    document.getElementById('winMessage').textContent='You scored '+score+'! Good job!';
                    document.getElementById('winScreen').style.display='block';
                } else {
                    initLevel();
                }
            }
        }
    }
    draw();
}

function draw(){
    ctx.fillStyle='#74b9ff';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // dog
    const dogX=dog.x*gridSize+gridSize/2;
    const dogY=dog.y*gridSize+gridSize/2;
    ctx.fillStyle='#f39c12';
    ctx.beginPath();
    ctx.arc(dogX,dogY,gridSize/2,0,Math.PI*2);
    ctx.fill();

    // ghosts
    ghosts.forEach(ghost=>{
        const ghostX=ghost.x*gridSize+gridSize/2;
        const ghostY=ghost.y*gridSize+gridSize/2;
        ctx.fillStyle='white';
        ctx.beginPath();
        ctx.arc(ghostX,ghostY,gridSize/2,0,Math.PI*2);
        ctx.fill();
        ctx.fillStyle='black';
        ctx.font='16px Arial';
        ctx.textAlign='center';
        ctx.textBaseline='middle';
        ctx.fillText('ğŸ‘» '+ghost.cantonese,ghostX,ghostY);
    });
}
</script>
</body>
</html>
