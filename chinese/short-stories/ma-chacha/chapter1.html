<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ç¬¬ä¸€ç«  ç¬¬ä¸€ç«  - é©¬å‰å‰çš„æˆ¿å­</title>
<style>
  /* ======= Page Content Styles ======= */
  body {
    font-family: Arial, sans-serif;
    line-height: 1.6;
    max-width: 800px;
    margin: 40px auto;
    padding: 0 20px;
    background-color: #fafafa;
    color: #333;
  }
  h1 {
    text-align: center;
    color: #0073e6;
    margin-bottom: 30px;
  }
  #chinese-text {
    white-space: pre-wrap;
    font-size: 1.25em;
    line-height: 2.2;
    margin-bottom: 30px;
    padding: 15px 20px;
    background-color: #ffffff;
    border: 1px solid #d1e3fc;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0, 115, 230, 0.1);
    font-family: "Noto Sans SC", "Microsoft Yahei", Arial, sans-serif;
    letter-spacing: 0.03em;
    text-indent: 2em;
  }
  #chinese-text p {
    margin-bottom: 1.5em;
  }
  #pinyin-text, #english-text {
    display: none;
    background: #eef6ff;
    border: 1px solid #b3d1ff;
    padding: 15px;
    margin: 10px 0 20px 0;
    white-space: pre-wrap;
    font-size: 1.1em;
  }
  button.toggle-btn {
    background-color: #0073e6;
    color: white;
    border: none;
    padding: 10px 18px;
    margin-right: 10px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1em;
  }
  button.toggle-btn:hover {
    background-color: #005bb5;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    background: #fff;
    margin-top: 30px;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 10px;
    text-align: left;
  }
  th {
    background-color: #e6f2ff;
    font-weight: bold;
  }
  tr:nth-child(even) {
    background-color: #f9f9f9;
  }
  footer {
    margin-top: 50px;
    text-align: center;
  }
  footer a {
    color: #0073e6;
    text-decoration: none;
    font-size: 1.1em;
  }
  footer a:hover {
    text-decoration: underline;
  }

  /* ======= Matching Game Styles ======= */

  #game-container {
    display: flex;
    justify-content: center;
    gap: 40px;
    margin-top: 30px;
    flex-wrap: nowrap; /* Prevent vertical stacking on small screens */
  }

  .column {
    display: flex;
    flex-direction: column;
    gap: 12px;
    width: 180px; /* Fixed width for consistent layout */
  }

  .card {
    padding: 14px 20px;
    background-color: #f0f8ff;
    border-radius: 10px;
    cursor: pointer;
    font-size: 1.2em;
    text-align: center;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    transition: background-color 0.3s ease, transform 0.2s ease;
    min-width: 160px;
    user-select: none;
  }

  .card:hover:not(.matched):not(.animating) {
    background-color: #d6ecff;
    transform: scale(1.05);
  }

  .card.matched {
    background-color: #ccc !important;
    color: #666;
    cursor: default;
    box-shadow: none;
    transform: none !important;
  }

  .selected {
    background-color: #b3e0ff !important;
  }

  /* Animations for feedback */
  @keyframes flashGreen {
    0%, 100% { background-color: #b3e0ff; }
    50% { background-color: #a0f0a0; }
  }
  @keyframes flashRed {
    0%, 100% { background-color: #b3e0ff; }
    50% { background-color: #f28b82; }
  }
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    20%, 60% { transform: translateX(-6px); }
    40%, 80% { transform: translateX(6px); }
  }

  .flash-green {
    animation: flashGreen 0.5s ease forwards;
  }

  .flash-red {
    animation: flashRed 0.5s ease forwards;
  }

  .shake {
    animation: shake 0.5s ease;
  }

  /* Feedback text style */
  #feedback {
    text-align: center;
    font-weight: bold;
    font-size: 1.3em;
    min-height: 1.4em;
    margin-top: 15px;
  }

  /* Timer and progress bar */
  #timer-container {
    text-align: center;
    margin-top: 30px;
    font-size: 1.6em;
    font-weight: bold;
    color: #0073e6;
  }
  #timer-container.low-time {
    color: #e63946; /* Red when time low */
  }

  #progress-bar {
    width: 100%;
    height: 12px;
    background-color: #d1e3fc;
    border-radius: 6px;
    overflow: hidden;
    margin-top: 8px;
  }

  #progress-bar-fill {
    height: 100%;
    width: 100%;
    background-color: #0073e6;
    transition: width 0.3s linear;
  }

  /* Start button */
  #start-button {
    display: block;
    margin: 30px auto 20px auto;
    background-color: #0073e6;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 1.25em;
    cursor: pointer;
    box-shadow: 0 5px 10px rgba(0, 115, 230, 0.4);
    transition: background-color 0.3s ease;
  }
  #start-button:hover {
    background-color: #005bb5;
  }

  /* Responsive tweak: prevent stacking by setting min-width */
  @media (max-width: 460px) {
    #game-container {
      gap: 20px;
    }
    .column {
      width: 150px;
    }
    .card {
      min-width: 130px;
      font-size: 1.1em;
    }
  }
</style>
</head>
<body>

<h1>ç¬¬ä¸€ç« : é©¬å‰å‰çš„æˆ¿å­</h1>

<p><strong>æ”¶å¬ç¬¬ä¸€ç« ï¼š</strong></p>
<iframe width="360" height="202"
        src="https://www.youtube.com/embed/FUiR9DOUybw"
        title="YouTube video player"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen>
</iframe>

<!-- Chinese text -->
<div id="chinese-text" style="white-space: pre-line;">
é©¬å‰å‰æœ‰ä¸€ä¸ªæˆ¿å­ã€‚æˆ¿å­ä¸å¤§ï¼Œä¹Ÿä¸å°ã€‚æˆ¿å­åœ¨å—è¾¹ï¼Œä¸œè¾¹æœ‰ä¸€æ£µæ ‘ï¼ŒåŒ—è¾¹æœ‰ä¸€ä¸ªç«è½¦ç«™ã€‚
æ¯å¤©æ—©ä¸Šï¼Œé©¬å‰å‰å¼€è½¦å»ç«è½¦ç«™ã€‚ä¸æ˜¯å› ä¸ºä»–è¦å»å·¥ä½œï¼Œè€Œæ˜¯å› ä¸ºä»–æƒ³çœ‹ç«è½¦ã€‚ä»–è¯´ï¼šâ€œä¸–ç•Œä¸é”™ï¼Œä½†æ˜¯æˆ‘å¾ˆå–œæ¬¢ç«è½¦!â€
é©¬å‰å‰æœ‰ä¸€ä¸ªæœ‹å‹ï¼Œæ˜¯ä¸€åªçŒ«ã€‚çŒ«ä¸è¯´è¯ï¼Œä½†æ˜¯å–œæ¬¢å¬éŸ³ä¹ã€‚é©¬å‰å‰ä¸‹ç­ä»¥åï¼Œæ€»æ˜¯å›å®¶ï¼Œè·ŸçŒ«ä¸€èµ·å¬éŸ³ä¹ï¼Œå–ç‰›å¥¶ï¼Œåƒæ–¹ä¾¿é¢ã€‚ä»–ä»¬åœ¨ä¸€èµ·å¾ˆå¼€å¿ƒã€‚
æ™šä¸Šï¼Œé©¬å‰å‰ååœ¨ç”µè„‘å‰ï¼Œçœ‹è§ä¸€æœ¬ä¹¦ã€‚ä»–è¯´ï¼šâ€œè¿™æ˜¯ä»€ä¹ˆä¹¦ï¼Ÿæˆ‘è¿˜æ²¡çœ‹è¿‡è¿™æœ¬ä¹¦ã€‚â€çŒ«çœ‹äº†çœ‹ä¹¦ï¼Œå«äº†ä¸€å£°ï¼šâ€œå–µã€‚â€
</div>

<!-- Buttons -->
<div style="margin-top: 15px;">
  <button class="toggle-btn" onclick="toggleVisibility('pinyin-text')">æ‹¼éŸ³</button>
  <button class="toggle-btn" onclick="toggleVisibility('english-text')">è‹±æ–‡</button>
</div>

<!-- Pinyin text -->
<div id="pinyin-text">
MÇ ChÄchÄ yÇ’u yÃ­ gÃ¨ fÃ¡ngzi. FÃ¡ngzi bÃº dÃ , yÄ› bÃ¹ xiÇo. FÃ¡ngzi zÃ i nÃ¡nbian, dÅngbian yÇ’u yÃ¬ kÄ“ shÃ¹, bÄ›ibian yÇ’u yÃ­ gÃ¨ huÇ’chÄ“zhÃ n.
MÄ›itiÄn zÇoshang, MÇ ChÄchÄ kÄichÄ“ qÃ¹ huÇ’chÄ“zhÃ n. BÃº shÃ¬ yÄ«nwÃ¨i tÄ yÃ o qÃ¹ gÅngzuÃ², Ã©r shÃ¬ yÄ«nwÃ¨i tÄ xiÇng kÃ n huÇ’chÄ“. TÄ shuÅ: â€œShÃ¬jiÃ¨ bÃºcuÃ², dÃ nshÃ¬ wÇ’ hÄ›n xÇhuÄn huÇ’chÄ“!â€
MÇ ChÄchÄ yÇ’u yÃ­ gÃ¨ pÃ©ngyÇ’u, shÃ¬ yÃ¬ zhÄ« mÄo. MÄo bÃ¹ shuÅhuÃ , dÃ nshÃ¬ xÇhuÄn tÄ«ng yÄ«nyuÃ¨. MÇ ChÄchÄ xiÃ bÄn yÇhÃ²u, zÇ’ngshÃ¬ huÃ­jiÄ, gÄ“n mÄo yÃ¬qÇ tÄ«ng yÄ«nyuÃ¨, hÄ“ niÃºnÇi, chÄ« fÄngbiÃ nmiÃ n. TÄmen zÃ i yÃ¬qÇ hÄ›n kÄixÄ«n.
WÇnshÃ ng, MÇ ChÄchÄ zuÃ² zÃ i diÃ nnÇo qiÃ¡n, kÃ njiÃ n yÃ¬ bÄ›n shÅ«. TÄ shuÅ: â€œZhÃ¨ shÃ¬ shÃ©nme shÅ«? WÇ’ hÃ¡i mÃ©i kÃ nguÃ² zhÃ¨ bÄ›n shÅ«.â€ MÄo kÃ nle kÃ n shÅ«, jiÃ o le yÃ¬ shÄ“ng: â€œMiÄo.â€
</div>

<!-- English text -->
<div id="english-text">
Ma Chacha has a house. The house is not big, not small. The house is in the south. To the east, there is a tree. To the north, there is a train station.
Every morning, Ma Chacha drives to the train station. Itâ€™s not because heâ€™s going to work, but because he wants to watch the trains. He says, â€œThe world is not bad, but I really like trains!â€
Ma Chacha has a friend â€” a cat. The cat doesnâ€™t talk, but it likes listening to music. After work, Ma Chacha always goes home to listen to music with the cat, drink milk, and eat instant noodles. They are very happy when together.
At night, Ma Chacha sits in front of his computer and sees a book. He says, â€œWhat kind of book is this? I havenâ€™t seen this book before.â€ The cat looked at the book and meowed: â€œMeow.â€
</div>

<!-- Vocabulary list -->
<h2>ç”Ÿè¯</h2>
<table>
  <thead>
    <tr>
      <th>æ±‰å­—</th>
      <th>æ‹¼éŸ³</th>
      <th>æ„æ€</th>
    </tr>
  </thead>
  <tbody>
    <tr><td>æ£µ</td><td>kÄ“</td><td>measure word for trees and plants</td></tr>
    <tr><td>æ¯å¤©</td><td>mÄ›itiÄn</td><td>every day</td></tr>
    <tr><td>å«</td><td>jiÃ o</td><td>to call / to cry (animal sounds)</td></tr>
    <tr><td>å®‰é™</td><td>ÄnjÃ¬ng</td><td>quiet / peaceful</td></tr>
    <tr><td>çœ‹è§</td><td>kÃ njiÃ n</td><td>to see / catch sight of</td></tr>
    <tr><td>ä¸æ˜¯å› ä¸º...è€Œæ˜¯...</td><td>bÃº shÃ¬ yÄ«n wÃ¨i... Ã©r shÃ¬...</td><td>not because... but rather...</td></tr>
    <tr><td>ä¸é”™</td><td>bÃºcuÃ²</td><td>not bad</td></tr>
    <tr><td>å</td><td>zuÃ²</td><td>to sit</td></tr>
    <tr><td>è¿˜æ²¡...è¿‡</td><td>hÃ¡i mÃ©i ... guÃ²</td><td>have not ... yet</td></tr>
    <tr><td>å£°</td><td>shÄ“ng</td><td>sound</td></tr>
    <tr><td>å¥‡æ€ª</td><td>qÃ­guÃ i</td><td>strange</td></tr>
    <tr><td>ä¸–ç•Œ</td><td>shÃ¬jiÃ¨</td><td>world</td></tr>
  </tbody>
</table>

<!-- Start button -->
<button id="start-button">å¼€å§‹</button>

<!-- Timer display -->
<div id="timer-container" style="display:none;">
  Time left: <span id="timer">90</span>s
  <div id="progress-bar"><div id="progress-bar-fill"></div></div>
</div>

<!-- Matching Game -->
<div id="game-container" aria-live="polite" aria-label="Vocabulary matching game">
  <div class="column" id="left-column"></div>
  <div class="column" id="right-column"></div>
</div>

<p id="feedback"></p>
<div id="end-message" style="margin-top: 30px; text-align: center; font-size: 1.3em;"></div>

<script>
  // Toggle visibility for pinyin and english
  function toggleVisibility(id) {
    const el = document.getElementById(id);
    el.style.display = (el.style.display === 'block') ? 'none' : 'block';
  }

  const vocab = {
    "æ£µ": ["measure word for trees and plants"],
    "æ¯å¤©": ["every day"],
    "å«": ["to call / to cry (animal sounds)"],
    "å®‰é™": ["quiet / peaceful"],
    "çœ‹è§": ["to see / catch sight of"],
    "ä¸æ˜¯å› ä¸º...è€Œæ˜¯...": ["not because... but rather..."],
    "ä¸é”™": ["not bad"],
    "å": ["to sit"],
    "è¿˜æ²¡...è¿‡": ["have not ... yet"],
    "å£°": ["sound"],
    "å¥‡æ€ª": ["strange"],
    "ä¸–ç•Œ": ["world"]
  };

  let currentGameVocab = {};
  let selectedLeft = null;
  let selectedRight = null;
  let matched = 0;
  let timerInterval = null;
  let timeLeft = 90;
  let gameActive = false;

  function shuffleArray(arr) {
    return arr.sort(() => Math.random() - 0.5);
  }

  function createCards() {
    const leftColumn = document.getElementById('left-column');
    const rightColumn = document.getElementById('right-column');
    const feedback = document.getElementById('feedback');
    const endMessage = document.getElementById('end-message');

    leftColumn.innerHTML = '';
    rightColumn.innerHTML = '';
    feedback.textContent = '';
    endMessage.innerHTML = '';

    matched = 0;
    selectedLeft = null;
    selectedRight = null;

    // Choose 6 random entries from vocab
    const allEntries = Object.entries(vocab);
    const selectedEntries = shuffleArray(allEntries).slice(0, 6);

    const selectedVocab = {};
    selectedEntries.forEach(([word, defs]) => {
      selectedVocab[word] = defs[0];
    });

    currentGameVocab = selectedVocab;

    // Shuffle both sides independently
    const shuffledChinese = shuffleArray(Object.keys(selectedVocab));
    const shuffledEnglish = shuffleArray(Object.values(selectedVocab));

    shuffledChinese.forEach(word => {
      const card = document.createElement('div');
      card.className = 'card';
      card.textContent = word;
      card.onclick = () => handleLeftClick(card, word);
      leftColumn.appendChild(card);
    });

    shuffledEnglish.forEach(def => {
      const card = document.createElement('div');
      card.className = 'card';
      card.textContent = def;
      card.onclick = () => handleRightClick(card, def);
      rightColumn.appendChild(card);
    });
  }

  function clearSelections(side) {
    const cards = document.querySelectorAll(`#${side}-column .card`);
    cards.forEach(c => c.classList.remove('selected'));
  }

  function handleLeftClick(card, word) {
    if (!gameActive) return;
    if (card.classList.contains('matched') || card.classList.contains('animating')) return;
    clearSelections('left');
    selectedLeft = { card, word };
    card.classList.add('selected');
    checkMatch();
  }

  function handleRightClick(card, def) {
    if (!gameActive) return;
    if (card.classList.contains('matched') || card.classList.contains('animating')) return;
    clearSelections('right');
    selectedRight = { card, def };
    card.classList.add('selected');
    checkMatch();
  }

  function checkMatch() {
    if (selectedLeft && selectedRight) {
      const correctDef = currentGameVocab[selectedLeft.word];
      const feedback = document.getElementById('feedback');

      if (correctDef === selectedRight.def) {
        // Correct match
        selectedLeft.card.classList.add('matched', 'flash-green');
        selectedRight.card.classList.add('matched', 'flash-green');
        selectedLeft.card.onclick = null;
        selectedRight.card.onclick = null;
        feedback.textContent = 'âœ… æ­£ç¡®!';

        // Remove animation classes after animation ends
        setTimeout(() => {
          selectedLeft.card.classList.remove('flash-green');
          selectedRight.card.classList.remove('flash-green');
        }, 500);

        matched++;
        selectedLeft = null;
        selectedRight = null;

        if (matched === 6) {
          // Pause briefly before loading new set
          setTimeout(() => {
            createCards();
          }, 700);
        }
      } else {
        feedback.textContent = 'âŒ å†è¯•ä¸€æ¬¡!';
        // Add shake and flash red effect on wrong cards
        selectedLeft.card.classList.add('shake', 'flash-red', 'animating');
        selectedRight.card.classList.add('shake', 'flash-red', 'animating');

        // Disable clicking on these cards while animating
        selectedLeft.card.onclick = null;
        selectedRight.card.onclick = null;

        // After animation, clear selections and re-enable clicks
        setTimeout(() => {
          selectedLeft.card.classList.remove('shake', 'flash-red', 'animating', 'selected');
          selectedRight.card.classList.remove('shake', 'flash-red', 'animating', 'selected');

          // Re-enable clicks
          selectedLeft.card.onclick = () => handleLeftClick(selectedLeft.card, selectedLeft.word);
          selectedRight.card.onclick = () => handleRightClick(selectedRight.card, selectedRight.def);

          selectedLeft = null;
          selectedRight = null;
          feedback.textContent = '';
        }, 500);
      }
    }
  }

  function startGame() {
    if (gameActive) return;
    gameActive = true;
    timeLeft = 90;
    document.getElementById('timer-container').style.display = 'block';
    document.getElementById('start-button').style.display = 'none';
    createCards();
    updateTimerDisplay();
    timerInterval = setInterval(() => {
      timeLeft--;
      updateTimerDisplay();
      if (timeLeft <= 0) {
        endGame();
      }
    }, 1000);
  }

  function updateTimerDisplay() {
    const timerSpan = document.getElementById('timer');
    const timerContainer = document.getElementById('timer-container');
    const progressBarFill = document.getElementById('progress-bar-fill');

    timerSpan.textContent = timeLeft;
    let percent = (timeLeft / 90) * 100;
    progressBarFill.style.width = percent + '%';

    if (timeLeft <= 15) {
      timerContainer.classList.add('low-time');
    } else {
      timerContainer.classList.remove('low-time');
    }
  }

  function endGame() {
    gameActive = false;
    clearInterval(timerInterval);
    document.getElementById('feedback').textContent = '';
    document.getElementById('timer-container').style.display = 'none';

    const endMessage = document.getElementById('end-message');
    endMessage.innerHTML = `
      <p>ğŸ‰ æ­å–œä½ ï¼ä½ åœ¨90ç§’å†…é…å¯¹äº† <strong>${matched}</strong> ä¸ªæ­£ç¡®ã€‚</p>
      <button id="start-button-again">å†æ¥ä¸€æ¬¡</button>
    `;

    // Disable all cards clicks
    document.querySelectorAll('.card').forEach(card => card.onclick = null);

    document.getElementById('start-button-again').onclick = () => {
      endMessage.innerHTML = '';
      document.getElementById('start-button').style.display = 'inline-block';
    };
  }

  // Set up start button event listener
  document.getElementById('start-button').addEventListener('click', startGame);
</script>

<footer>
  <a href="base-vocabulary.html">â† è¿”å› ç”Ÿè¯</a> |
  <a href="chapter2.html">ç¬¬äºŒç«  â†’</a> |
  <a href="/chinese/short-stories/ma-chacha.html">è¿”å›é¦–é¡µ</a>
</footer>

</body>
</html>
