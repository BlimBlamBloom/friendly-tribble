<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Verb Uno Multiplayer</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Arial', sans-serif;
    background: linear-gradient(135deg, #2d3436 0%, #000000 100%);
    min-height: 100vh;
    padding: 20px;
    color: white;
}

#gameContainer {
    max-width: 1400px;
    margin: 0 auto;
}

h1 {
    text-align: center;
    font-size: 48px;
    margin-bottom: 30px;
    color: #ffd700;
}

#startScreen {
    text-align: center;
    background: white;
    color: #2d3436;
    padding: 50px;
    border-radius: 20px;
    max-width: 800px;
    margin: 0 auto 30px;
}

#startScreen h2 {
    color: #667eea;
    font-size: 36px;
    margin-bottom: 30px;
}

#startScreen button {
    margin: 10px;
}

#howToPlay {
    display: none;
    text-align: left;
    margin: 30px auto;
    padding: 30px;
    background: #f8f9fa;
    border-radius: 15px;
    max-width: 700px;
    color: #2d3436;
}

#howToPlay h3 {
    color: #667eea;
    margin-bottom: 15px;
}

#howToPlay p, #howToPlay ul {
    font-size: 18px;
    line-height: 1.8;
    margin-bottom: 15px;
}

#howToPlay ul {
    margin-left: 20px;
}

#howToPlay li {
    margin-bottom: 10px;
}

#gameBoard {
    display: grid;
    grid-template-rows: auto auto auto;
    grid-template-columns: 200px 1fr 200px;
    gap: 20px;
    align-items: center;
}

.opponent-left {
    grid-row: 2;
    grid-column: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
}

.opponent-top {
    grid-row: 1;
    grid-column: 2;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
}

.opponent-right {
    grid-row: 2;
    grid-column: 3;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
}

.opponent-cards {
    display: flex;
    gap: -30px;
    flex-wrap: wrap;
    justify-content: center;
}

.opponent-cards-vertical {
    display: flex;
    flex-direction: column;
    gap: -30px;
    align-items: center;
}

.mini-card {
    width: 50px;
    height: 70px;
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    border-radius: 8px;
    border: 2px solid rgba(255,255,255,0.3);
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.opponent-area {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
}

.player-info {
    font-size: 20px;
    font-weight: bold;
    text-align: center;
}

.card-count {
    background: rgba(255,255,255,0.2);
    padding: 8px 15px;
    border-radius: 8px;
    font-size: 16px;
    margin-top: 5px;
}

#centerArea {
    grid-row: 2;
    grid-column: 2;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 40px;
    padding: 40px;
}

#playerArea {
    grid-row: 3;
    grid-column: 1 / 4;
}

.card {
    width: 140px;
    height: 200px;
    border-radius: 15px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    border: 4px solid rgba(255,255,255,0.3);
}

.card:hover {
    transform: translateY(-10px);
}

.card.unplayable {
    opacity: 0.5;
}

.card-back {
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    color: white;
    font-size: 48px;
}

.pronoun {
    font-size: 18px;
    margin-bottom: 10px;
    text-transform: uppercase;
}

.verb {
    font-size: 24px;
    color: white;
}

.color-yo { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); }
.color-tu { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); }
.color-el { background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); }
.color-nosotros { background: linear-gradient(135deg, #f39c12 0%, #d68910 100%); }
.color-vosotros { background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); }
.color-ellos { background: linear-gradient(135deg, #1abc9c 0%, #16a085 100%); }

#playerHand {
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
    padding: 20px;
    background: rgba(255,255,255,0.1);
    border-radius: 20px;
}

#drawPile {
    cursor: pointer;
}

#drawPile:hover {
    transform: scale(1.05);
}

#message {
    text-align: center;
    font-size: 28px;
    font-weight: bold;
    min-height: 40px;
    color: #ffd700;
}

#gameOver {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    color: #2d3436;
    padding: 50px;
    border-radius: 20px;
    text-align: center;
    box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    display: none;
    z-index: 1000;
}

#gameOver h2 {
    font-size: 42px;
    margin-bottom: 30px;
    color: #ffd700;
}

.standings {
    font-size: 24px;
    margin: 20px 0;
    text-align: left;
}

.standings div {
    padding: 10px;
    margin: 5px 0;
    background: #f8f9fa;
    border-radius: 10px;
}

button {
    font-size: 24px;
    padding: 15px 40px;
    background: #667eea;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: bold;
    margin-top: 20px;
}

button:hover {
    background: #764ba2;
}

.flying-card {
    position: fixed;
    width: 140px;
    height: 200px;
    border-radius: 15px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-size: 20px;
    font-weight: bold;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    border: 4px solid rgba(255,255,255,0.3);
    z-index: 1000;
    pointer-events: none;
    transition: all 0.6s ease-in-out;
}
</style>
</head>
<body>
<div id="gameContainer">
<h1>üé¥ Verb Uno Multiplayer üé¥</h1>

<div id="startScreen">
    <h2>Welcome to Verb Uno!</h2>
    <input id="roomIdInput" placeholder="Room ID (optional)">
    <button onclick="joinGame()">Join / Create Game</button>
    <button onclick="toggleRules()">How to Play</button>

    <div id="howToPlay">
        <h3>How to Play Verb Uno</h3>
        <p><strong>Objective:</strong> Be the first player to play all your cards.</p>
        <h3>Setup:</h3>
        <ul>
            <li>Each player starts with 7 cards</li>
            <li>One card is placed face-up to start the discard pile</li>
        </ul>
        <h3>Card Colors:</h3>
        <ul>
            <li>Each colour represents a pronoun: yo, t√∫, √©l/ella, nosotros, vosotros, ellos/ellas</li>
            <li>Each card also shows a conjugated verb</li>
        </ul>
        <h3>On Your Turn:</h3>
        <ul>
            <li>Play a card that matches either the COLOUR (pronoun) OR the VERB of the top card</li>
            <li>If you can't play or don't want to, click DRAW to draw a card. Your turn then ends.</li>
        </ul>
        <h3>Winning:</h3>
        <p>The first player to play all their cards wins!</p>
    </div>
</div>

<div id="gameBoard" style="display:none;">
    <div class="opponent-top">
        <div class="player-info">
            <div>Player 2 / Computer 2</div>
            <div class="card-count" id="comp2Cards">7 cards</div>
        </div>
        <div class="opponent-cards" id="comp2Display"></div>
    </div>

    <div class="opponent-left">
        <div class="player-info">
            <div>Computer 1</div>
            <div class="card-count" id="comp1Cards">7 cards</div>
        </div>
        <div class="opponent-cards-vertical" id="comp1Display"></div>
    </div>

    <div id="centerArea">
        <div class="card card-back" id="drawPile" onclick="drawCard()">DRAW</div>
        <div class="card" id="discardPile"></div>
    </div>

    <div class="opponent-right">
        <div class="player-info">
            <div>Computer 3</div>
            <div class="card-count" id="comp3Cards">7 cards</div>
        </div>
        <div class="opponent-cards-vertical" id="comp3Display"></div>
    </div>

    <div id="playerArea">
        <div id="message"></div>
        <div id="playerHand"></div>
    </div>
</div>
</div>

<div id="gameOver">
    <h2 id="winnerText"></h2>
    <div class="standings" id="standings"></div>
    <button onclick="restartGame()">Play Again</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script>
// ===== FIREBASE CONFIG =====
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_SENDER",
    appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ===== GAME DATA =====
const verbs = {
    hablar: ['hablo','hablas','habla','hablamos','habl√°is','hablan'],
    escuchar: ['escucho','escuchas','escucha','escuchamos','escuch√°is','escuchan'],
    estudiar: ['estudio','estudias','estudia','estudiamos','estudi√°is','estudian'],
    bailar: ['bailo','bailas','baila','bailamos','bail√°is','bailan'],
    viajar: ['viajo','viajas','viaja','viajamos','viaj√°is','viajan'],
    trabajar: ['trabajo','trabajas','trabaja','trabajamos','trabaj√°is','trabajan'],
    tener: ['tengo','tienes','tiene','tenemos','ten√©is','tienen'],
    hacer: ['hago','haces','hace','hacemos','hac√©is','hacen'],
    comer: ['como','comes','come','comemos','com√©is','comen'],
    estar: ['estoy','est√°s','est√°','estamos','est√°is','est√°n']
};
const pronouns = ['yo','t√∫','√©l/ella','nosotros','vosotros','ellos/ellas'];
const colors = ['yo','tu','el','nosotros','vosotros','ellos'];

// ===== STATE =====
let deck = [], hands = {}, discardPile = [], currentPlayer = 0;
let roomId=null, playerSlot=null, unsubscribe=null;

// ===== FUNCTIONS =====
function toggleRules(){
    const r=document.getElementById('howToPlay');
    r.style.display=r.style.display==='none'?'block':'none';
}

function genId(len=5){
    let s="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",id="";
    for(let i=0;i<len;i++)id+=s[Math.floor(Math.random()*s.length)];
    return id;
}

async function joinGame(){
    let input=document.getElementById("roomIdInput").value.trim();
    if(!input){
        roomId=genId();
        playerSlot=0;
        await db.collection("rooms").doc(roomId).set({deck:[],hands:{},discard:[],currentPlayer:0});
        alert("Room created: "+roomId);
    } else {
        roomId=input;
        playerSlot=2;
    }
    document.getElementById("startScreen").style.display="none";
    document.getElementById("gameBoard").style.display="grid";
    if(playerSlot===0) await initFirebaseGame();
    watchGame();
}

function createDeck(){
    deck=[];
    Object.keys(verbs).forEach(v=>{
        verbs[v].forEach((conj,i)=>{
            for(let j=0;j<2;j++){
                deck.push({verb:v,conjugation:conj,pronoun:pronouns[i],color:colors[i]});
            }
        });
    });
    shuffleDeck();
}

function shuffleDeck(){
    for(let i=deck.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [deck[i],deck[j]]=[deck[j],deck[i]];
    }
}

function dealCards(){
    hands[0]=deck.splice(0,7);
    hands[1]=deck.splice(0,7);
    hands[2]=deck.splice(0,7);
    hands[3]=deck.splice(0,7);
    discardPile=[deck.pop()];
}

async function initFirebaseGame(){
    createDeck();
    dealCards();
    await db.collection("rooms").doc(roomId).update({
        deck, hands, discard: discardPile, currentPlayer:0
    });
}

function watchGame(){
    unsubscribe=db.collection("rooms").doc(roomId)
        .onSnapshot(doc=>{
            if(!doc.exists)return;
            let g=doc.data();
            deck=g.deck; hands=g.hands; discardPile=g.discard; currentPlayer=g.currentPlayer;
            renderHand();
            if(checkWin()) showGameOver();
            if(currentPlayer!==playerSlot) makeComputerMove();
        });
}

function renderCard(card,index=null){
    const el=document.createElement("div");
    el.className=`card color-${card.color}`;
    el.innerHTML=`<div class="pronoun">${card.pronoun}</div><div class="verb">${card.conjugation}</div>`;
    if(index!==null&&currentPlayer===playerSlot) el.onclick=()=>playCard(index);
    return el;
}

function renderHand(){
    const handEl=document.getElementById("playerHand");
    handEl.innerHTML="";
    if(hands[playerSlot])hands[playerSlot].forEach((c,i)=>handEl.appendChild(renderCard(c,i)));
    renderOpponentCards("comp1Display",hands[1]?hands[1].length:0);
    renderOpponentCards("comp2Display",hands[2]?hands[2].length:0);
    renderOpponentCards("comp3Display",hands[3]?hands[3].length:0);
    document.getElementById("comp1Cards").textContent=(hands[1]?hands[1].length:0)+" cards";
    document.getElementById("comp2Cards").textContent=(hands[2]?hands[2].length:0)+" cards";
    document.getElementById("comp3Cards").textContent=(hands[3]?hands[3].length:0)+" cards";
    const d=document.getElementById("discardPile"); d.innerHTML="";
    if(discardPile.length>0){
        const top=discardPile[discardPile.length-1];
        d.className=`card color-${top.color}`;
        d.innerHTML=`<div class="pronoun">${top.pronoun}</div><div class="verb">${top.conjugation}</div>`;
    }
}

function renderOpponentCards(id,count){
    const c=document.getElementById(id); c.innerHTML="";
    for(let i=0;i<count;i++){const mc=document.createElement("div");mc.className="mini-card";c.appendChild(mc);}
}

function isValidPlay(card){
    if(discardPile.length===0)return true;
    const top=discardPile[discardPile.length-1];
    return card.color===top.color||card.conjugation===top.conjugation;
}

async function playCard(index){
    if(currentPlayer!==playerSlot)return;
    const card=hands[playerSlot][index];
    if(!isValidPlay(card))return;
    hands[playerSlot].splice(index,1);
    discardPile.push(card);
    await advanceTurn();
}

async function drawCard(){
    if(currentPlayer!==playerSlot)return;
    if(deck.length===0) recycleDeck();
    hands[playerSlot].push(deck.pop());
    await advanceTurn();
}

function recycleDeck(){
    const top=discardPile.pop();
    deck=[...discardPile];
    discardPile=[top];
    shuffleDeck();
}

async function advanceTurn(){
    const next=(currentPlayer+1)%4;
    await db.collection("rooms").doc(roomId).update({deck,hands,discard:discardPile,currentPlayer:next});
}

function makeComputerMove(){
    if(currentPlayer!==1&&currentPlayer!==3)return;
    const hand=hands[currentPlayer];
    const played=hand.find(c=>isValidPlay(c));
    if(played){hand.splice(hand.indexOf(played),1); discardPile.push(played);}
    else {if(deck.length===0) recycleDeck(); hand.push(deck.pop());}
    advanceTurn();
}

function checkWin(){
    return Object.values(hands).some(h=>h.length===0);
}

function showGameOver(){
    document.getElementById("gameOver").style.display="block";
    const winner=Object.keys(hands).find(i=>hands[i].length===0);
    document.getElementById("winnerText").textContent=winner==playerSlot?"You Win!":`Player ${winner} Wins!`;
}

async function restartGame(){
    document.getElementById("gameOver").style.display="none";
    if(playerSlot===0) await initFirebaseGame();
}

</script>
</body>
</html>
