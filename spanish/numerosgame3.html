<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No me gusta la lluvia - Spanish Numbers</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { width: 100%; height: 100%; overflow: hidden; font-family: sans-serif; }
        #root { width: 100%; height: 100%; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .animate-bounce { animation: bounce 0.4s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .animate-pulse { animation: pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const spanishNumbersMap = {
            0: "cero", 1: "uno", 2: "dos", 3: "tres", 4: "cuatro", 5: "cinco",
            6: "seis", 7: "siete", 8: "ocho", 9: "nueve", 10: "diez",
            11: "once", 12: "doce", 13: "trece", 14: "catorce", 15: "quince",
            16: "dieciséis", 17: "diecisiete", 18: "dieciocho", 19: "diecinueve",
            20: "veinte", 21: "veintiuno", 22: "veintidós", 23: "veintitrés",
            24: "veinticuatro", 25: "veinticinco", 26: "veintiséis", 27: "veintisiete",
            28: "veintiocho", 29: "veintinueve", 30: "treinta", 40: "cuarenta", 50: "cincuenta"
        };

        const getSpanishName = (num) => {
            if (spanishNumbersMap[num]) return spanishNumbersMap[num];
            if (num > 30 && num < 40) return `treinta y ${spanishNumbersMap[num - 30]}`;
            if (num > 40 && num < 50) return `cuarenta y ${spanishNumbersMap[num - 40]}`;
            return num.toString();
        };

        const SpanishRainGame = () => {
            const [drops, setDrops] = useState([]);
            const [titleRaindrops, setTitleRaindrops] = useState([]);
            const [score, setScore] = useState(0);
            const [misses, setMisses] = useState(0);
            const [selectedDrop, setSelectedDrop] = useState(null);
            const [gameOver, setGameOver] = useState(false);
            const [gameWon, setGameWon] = useState(false);
            const [showTitle, setShowTitle] = useState(true);
            const [penguinPos, setPenguinPos] = useState(10);
            const [penguinDirection, setPenguinDirection] = useState(1);
            const dropIdRef = useRef(0);
            const titleDropIdRef = useRef(0);
            const spawnTimerRef = useRef(null);

            const createDrop = (type = null, matchNum = null, existingDrops = []) => {
                let maxNum = 10;
                if (score > 40) maxNum = 50;
                else if (score > 25) maxNum = 30;
                else if (score > 10) maxNum = 20;

                const num = matchNum !== null ? matchNum : Math.floor(Math.random() * (maxNum + 1));
                let text, dropType;

                if (type === 'digit' || (!type && Math.random() > 0.5)) {
                    text = num.toString();
                    dropType = 'digit';
                } else {
                    text = getSpanishName(num);
                    dropType = 'word';
                }

                const position = findValidPosition(existingDrops, 15);
                return {
                    id: dropIdRef.current++,
                    text,
                    type: dropType,
                    matchData: { num },
                    x: position.x,
                    y: position.y,
                    selected: false
                };
            };

            const isPositionTooClose = (x, y, existingDrops, minDistance = 15) => {
                return existingDrops.some(drop => {
                    const distance = Math.sqrt(Math.pow(drop.x - x, 2) + Math.pow(drop.y - y, 2));
                    return distance < minDistance;
                });
            };

            const findValidPosition = (existingDrops, minDistance = 15) => {
                let attempts = 0;
                let x, y;
                do {
                    x = Math.random() * 70 + 10;
                    y = -10 - Math.random() * 20;
                    attempts++;
                } while (isPositionTooClose(x, y, existingDrops, minDistance) && attempts < 100);
                return { x, y };
            };

            const handleDropClick = (drop) => {
                if (gameOver || gameWon) return;

                if (!selectedDrop) {
                    setSelectedDrop(drop);
                    setDrops(prev => prev.map(d => d.id === drop.id ? { ...d, selected: true } : d));
                } else {
                    if (selectedDrop.id === drop.id) {
                        setSelectedDrop(null);
                        setDrops(prev => prev.map(d => d.id === drop.id ? { ...d, selected: false } : d));
                        return;
                    }

                    if (selectedDrop.type === drop.type) {
                        setSelectedDrop(drop);
                        setDrops(prev => prev.map(d => {
                            if (d.id === drop.id) return { ...d, selected: true };
                            if (d.id === selectedDrop.id) return { ...d, selected: false };
                            return d;
                        }));
                        return;
                    }

                    if (selectedDrop.matchData.num === drop.matchData.num) {
                        setDrops(prev => prev.filter(d => d.id !== selectedDrop.id && d.id !== drop.id));
                        setScore(s => {
                            const newScore = s + 1;
                            if (newScore >= 100) setGameWon(true);
                            return newScore;
                        });
                        setSelectedDrop(null);
                    } else {
                        setSelectedDrop(null);
                        setDrops(prev => prev.map(d => ({ ...d, selected: false })));
                    }
                }
            };

            // Movement and Spawning logic
            useEffect(() => {
                if (showTitle || gameOver || gameWon) return;
                const moveInterval = setInterval(() => {
                    setPenguinPos(prev => {
                        const next = prev + penguinDirection * 1.2;
                        if (next > 90 || next < 10) { setPenguinDirection(d => -d); return prev; }
                        return next;
                    });
                }, 50);
                return () => clearInterval(moveInterval);
            }, [showTitle, gameOver, gameWon, penguinDirection]);

            useEffect(() => {
                if (gameOver || gameWon || showTitle) return;
                const spawnDropPair = () => {
                    setDrops(prev => {
                        const d1 = createDrop(null, null, prev);
                        const matchType = d1.type === 'digit' ? 'word' : 'digit';
                        const d2 = createDrop(matchType, d1.matchData.num, [...prev, d1]);
                        return [...prev, d1, d2];
                    });
                };
                spawnDropPair();
                spawnTimerRef.current = setInterval(spawnDropPair, Math.max(2000, 5000 - (Math.floor(score/10) * 500)));
                return () => clearInterval(spawnTimerRef.current);
            }, [gameOver, gameWon, showTitle, score]);

            useEffect(() => {
                if (gameOver || gameWon || showTitle) return;
                const interval = setInterval(() => {
                    setDrops(prev => {
                        const speed = 0.12 + (Math.floor(score / 10) * 0.03);
                        const updated = prev.map(d => ({ ...d, y: d.y + speed }));
                        const landed = updated.filter(d => d.y >= 95);
                        if (landed.length > 0) {
                            setMisses(m => {
                                const newMisses = m + landed.length;
                                if (newMisses >= 3) setGameOver(true);
                                return newMisses;
                            });
                            return updated.filter(d => d.y < 95);
                        }
                        return updated;
                    });
                }, 50);
                return () => clearInterval(interval);
            }, [gameOver, gameWon, showTitle, score]);

            const Penguin = () => (
                <svg width="100" height="100" viewBox="0 0 140 120" style={{ transform: penguinDirection === 1 ? 'scaleX(1)' : 'scaleX(-1)' }}>
                    <ellipse cx="70" cy="112" rx="30" ry="6" fill="#000" opacity="0.2" />
                    <ellipse cx="70" cy="75" rx="35" ry="42" fill="#2c3e50" />
                    <ellipse cx="72" cy="78" rx="26" ry="35" fill="#ecf0f1" />
                    <circle cx="92" cy="50" r="6" fill="#000" />
                    <path d="M 100 58 L 108 60 L 106 64 L 100 62 Z" fill="#ff8c42" />
                    <ellipse cx="58" cy="105" rx="16" ry="8" fill="#ff8c42" className="animate-bounce" />
                    <ellipse cx="82" cy="105" rx="16" ry="8" fill="#ff8c42" className="animate-bounce" style={{ animationDelay: '0.2s' }} />
                </svg>
            );

            return (
                <div style={{ width: '100%', height: '100vh', background: 'linear-gradient(to bottom, #475569, #6b7280)', position: 'relative' }}>
                    {showTitle ? (
                        <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', height: '100%' }}>
                            <h1 style={{ color: 'white', fontSize: '3rem', marginBottom: '2rem' }}>¡Los Números!</h1>
                            <button onClick={() => setShowTitle(false)} style={{ padding: '1rem 2.5rem', fontSize: '1.5rem', cursor: 'pointer', borderRadius: '10px', border: 'none', background: '#2563eb', color: 'white' }}>Jugar</button>
                        </div>
                    ) : (
                        <>
                            <div style={{ position: 'absolute', top: 20, left: 20, color: 'white', background: 'rgba(0,0,0,0.5)', padding: '10px', borderRadius: '8px' }}>Puntos: {score}/100</div>
                            <div style={{ position: 'absolute', top: 20, right: 20, color: 'white', background: 'rgba(0,0,0,0.5)', padding: '10px', borderRadius: '8px' }}>Errores: {misses}/3</div>
                            {drops.map(drop => (
                                <div key={drop.id} onClick={() => handleDropClick(drop)} style={{ position: 'absolute', left: `${drop.x}%`, top: `${drop.y}%`, transform: 'translate(-50%, -50%)', cursor: 'pointer' }}>
                                    <div className={drop.selected ? 'animate-pulse' : ''} style={{ position: 'relative' }}>
                                        <svg width="70" height="90" viewBox="0 0 80 100">
                                            <path d="M40 5 C20 25, 10 40, 10 60 C10 78, 23 92, 40 92 C57 92, 70 78, 70 60 C70 40, 60 25, 40 5 Z" fill={drop.selected ? '#fbbf24' : '#60a5fa'} stroke="white" />
                                        </svg>
                                        <div style={{ position: 'absolute', inset: 0, display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', fontWeight: 'bold', textShadow: '1px 1px 2px black' }}>{drop.text}</div>
                                    </div>
                                </div>
                            ))}
                            <div style={{ position: 'absolute', bottom: '2rem', left: `${penguinPos}%`, transform: 'translateX(-50%)' }}><Penguin /></div>
                        </>
                    )}
                    {(gameOver || gameWon) && (
                        <div style={{ position: 'absolute', inset: 0, background: 'rgba(0,0,0,0.8)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', flexDirection: 'column' }}>
                            <h2>{gameWon ? '¡Ganaste!' : 'Fin del Juego'}</h2>
                            <p>Puntuación: {score}</p>
                            <button onClick={() => window.location.reload()} style={{ marginTop: '20px', padding: '10px 20px' }}>Reiniciar</button>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<SpanishRainGame />, document.getElementById('root'));
    </script>
</body>
</html>
